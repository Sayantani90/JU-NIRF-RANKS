<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jadavpur University â€” NIRF Ranks Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>

  <body>
  <div class="header">
    <h1>Jadavpur University</h1>
    <p>NIRF Rankings Dashboard (2017 Onwards)</p>
  </div>

  <div class="container">
    <div class="stats-grid">
      <div class="stat-card">
        <h4>Best Overall Rank</h4>
        <div class="number" id="best-overall-rank">12</div>
        <div class="subtitle" id="best-overall-years">2017, 2020, 2022</div>
      </div>
      <div class="stat-card">
        <h4>Best University Rank</h4>
        <div class="number" id="best-university-rank">4</div>
        <div class="subtitle" id="best-university-years">2022, 2023</div>
      </div>
      <div class="stat-card">
        <h4>Best Engineering Rank</h4>
        <div class="number" id="best-engineering-rank">9</div>
        <div class="subtitle" id="best-engineering-years">2017</div>
      </div>
      <div class="stat-card"> #changed from research card
        <h4>Best State Public University Rank</h4>
        <div class="number" id="best-research-rank">1</div>
        <div class="subtitle" id="best-research-years">2025</div>
      </div>
    </div>
<!--
    <div class="input-section fade-in">
      <h3>ðŸ“Š Enter NIRF 2025 Rankings </h3>
      <div class="input-grid">
        <div class="input-group">
          <label for="Overall-2025">Overall Ranking</label>
          <input type="number" id="Overall-2025" placeholder="Enter rank..." />
        </div>
        <div class="input-group">
          <label for="University-2025">University Ranking</label>
          <input type="number" id="University-2025" placeholder="Enter rank..." />
        </div>
        <div class="input-group">
          <label for="Engineering-2025">Engineering Ranking</label>
          <input type="number" id="Engineering-2025" placeholder="Enter rank..." />
        </div>
        <div class="input-group">
          <label for="Research-2025">Research Ranking</label>
          <input type="number" id="Research-2025" placeholder="Enter rank..." />
        </div>
        <div class="input-group">
          <label for="Pharmacy-2025">Pharmacy Ranking</label>
          <input type="number" id="Pharmacy-2025" placeholder="Enter rank..." />
        </div>
        <div class="input-group">
          <label for="StatePublicUniversity-2025">State Public University</label>
          <input type="number" id="StatePublicUniversity-2025" placeholder="Enter rank..." />
        </div>
        <div class="input-group">
          <label for="Architecture-2025">Architecture Ranking</label>
          <input type="number" id="Architecture-2025" placeholder="Enter rank..." />
        </div>
      </div>
      <button onclick="update2025()">ðŸš€ Update Rankings</button>
    </div>
-->
    <div class="table-container fade-in">
      <table id="ranksTable">
        <thead>
          <tr>
            <th>Category</th>
            <th>2025</th>
            <th>2024</th>
            <th>2023</th>
            <th>2022</th>
            <th>2021</th>
            <th>2020</th>
            <th>2019</th>
            <th>2018</th>
            <th>2017</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>Overall</td><td id="Overall-2025-cell">â€”</td>18<td>17</td><td>13</td><td>12</td><td>14</td><td>12</td><td>13</td><td>13</td><td>12</td></tr>
          <tr><td>University</td><td id="University-2025-cell">â€”</td>9<td>9</td><td>4</td><td>4</td><td>8</td><td>5</td><td>6</td><td>6</td><td>5</td></tr>
          <tr><td>Engineering</td><td id="Engineering-2025-cell">â€”</td>18<td>12</td><td>10</td><td>11</td><td>17</td><td>17</td><td>14</td><td>12</td><td>9</td></tr>
          <tr><td>Research</td><td id="Research-2025-cell">â€”</td>23<td>21</td><td>19</td><td>13</td><td>17</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td></tr>
          <tr><td>Pharmacy</td><td id="Pharmacy-2025-cell">â€”</td>24<td>18</td><td>18</td><td>18</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td></tr>
          <tr><td>State Public University</td><td id="StatePublicUniversity-2025-cell">â€”</td>1<td>2</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td></tr>
          <tr><td>Architecture</td><td id="Architecture-2025-cell">â€”</td>16<td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td></tr>
        </tbody>
      </table>
    </div>

    <div class="charts fade-in">
      <div class="chart-container">
        <div class="chart-header">
          <h3>ðŸ“ˆ NIRF Rankings Trend Analysis</h3>
          <button onclick="downloadChart()" class="download-btn">ðŸ“¥ Download as JPEG</button>
        </div>
        <canvas id="nirfChart"></canvas>
        <div class="legend">
          <div class="legend-item">
            <span style="background-color: #e74c3c"></span>
            Overall
          </div>
          <div class="legend-item">
            <span style="background-color: #3498db"></span>
            University
          </div>
          <div class="legend-item">
            <span style="background-color: #2ecc71"></span>
            Engineering
          </div>
          <div class="legend-item">
            <span style="background-color: #9b59b6"></span>
            Research
          </div>
          <div class="legend-item">
            <span style="background-color: #f39c12"></span>
            Pharmacy
          </div>
          <div class="legend-item">
            <span style="background-color: #1abc9c"></span>
            State Public University
          </div>
          <div class="legend-item">
            <span style="background-color: #8b4513"></span>
            Architecture
          </div>
        </div>
      </div>
    </div>
	<div>
	  <a href="ju_nirf_metrics_2025.html" 
           style="display: inline-flex; 
                  align-items: center; 
                  gap: 0.75rem; 
                  padding: 1rem 2.5rem; 
                  background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); 
                  color: white; 
                  text-decoration: none; 
                  font-size: 1.1rem; 
                  font-weight: 600; 
                  border-radius: 50px; 
                  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
                  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
                  box-shadow: 0 8px 25px rgba(46, 204, 113, 0.4);"
           onmouseover="this.style.transform='translateY(-3px) scale(1.05)'; 
                        this.style.boxShadow='0 15px 40px rgba(46, 204, 113, 0.6)'; 
                        this.style.background='linear-gradient(135deg, #27ae60 0%, #2ecc71 100%)';"
           onmouseout="this.style.transform='translateY(0) scale(1)'; 
                       this.style.boxShadow='0 8px 25px rgba(46, 204, 113, 0.4)'; 
                       this.style.background='linear-gradient(135deg, #2ecc71 0%, #27ae60 100%)';"
           onmousedown="this.style.transform='translateY(-1px) scale(1.02)';"
           onmouseup="this.style.transform='translateY(-3px) scale(1.05)';">
          <span>Go To Detailed Analysis: 2024 Ranking</span>
          <span style="font-size: 1.3rem; transition: transform 0.3s ease;" 
                onmouseover="this.style.transform='translateX(5px)';"
                onmouseout="this.style.transform='translateX(0)';">â†’</span>
        </a>
	</div>  
  </div>

  <script>
    // Historical data for finding best ranks
    const historicalData = {
      Overall: [12, 13, 13, 12, 14, 12, 13, 17], // 2017-2024
      University: [5, 6, 6, 5, 8, 4, 4, 9], // 2017-2024
      Engineering: [9, 12, 14, 17, 17, 11, 10, 12], // 2017-2024
      Research: [null, null, null, null, 17, 13, 19, 21], // 2017-2024
      Pharmacy: [null, null, null, null, null, 18, 18, 18], // 2017-2024
      StatePublicUniversity: [null, null, null, null, null, null, null, 2], // 2017-2024
      Architecture: [null, null, null, null, null, null, null, null] // 2017-2024
    };

    const years = [2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024];

    function findBestRankAndYears(category, includeNew2025 = false, new2025Value = null) {
      let data = [...historicalData[category]];
      let yearsList = [...years];
      
      if (includeNew2025 && new2025Value) {
        data.push(new2025Value);
        yearsList.push(2025);
      }
      
      // Filter out null values and find minimum (best rank)
      const validData = data.map((rank, index) => ({ rank, year: yearsList[index] }))
                           .filter(item => item.rank !== null);
      
      if (validData.length === 0) return { bestRank: null, bestYears: [] };
      
      const bestRank = Math.min(...validData.map(item => item.rank));
      const bestYears = validData.filter(item => item.rank === bestRank)
                                .map(item => item.year);
      
      return { bestRank, bestYears };
    }

    function updateBestRankCard(category, bestRank, bestYears, isUpdated = false) {
      const categoryMap = {
        Overall: 'overall',
        University: 'university', 
        Engineering: 'engineering',
        Research: 'research'
      };
      
      const key = categoryMap[category];
      if (!key) return;
      
      const rankElement = document.getElementById(`best-${key}-rank`);
      const yearsElement = document.getElementById(`best-${key}-years`);
      const cardElement = rankElement.closest('.stat-card');
      
      if (rankElement && yearsElement) {
        rankElement.textContent = bestRank;
        yearsElement.textContent = bestYears.join(', ');
        
        if (isUpdated) {
          cardElement.classList.add('updated');
          setTimeout(() => {
            cardElement.classList.remove('updated');
          }, 3000);
        }
      }
    }

    const labels = [2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024];

    const data = {
      labels: [...labels],
      datasets: [
        { label: 'Overall', data: [12, 13, 13, 12, 14, 12, 13, 17], borderColor: '#e74c3c', backgroundColor: 'rgba(231, 76, 60, 0.1)', fill: false, tension: 0.4 },
        { label: 'University', data: [5, 6, 6, 5, 8, 4, 4, 9], borderColor: '#3498db', backgroundColor: 'rgba(52, 152, 219, 0.1)', fill: false, tension: 0.4 },
        { label: 'Engineering', data: [9, 12, 14, 17, 17, 11, 10, 12], borderColor: '#2ecc71', backgroundColor: 'rgba(46, 204, 113, 0.1)', fill: false, tension: 0.4 },
        { label: 'Research', data: [null, null, null, null, 17, 13, 19, 21], borderColor: '#9b59b6', backgroundColor: 'rgba(155, 89, 182, 0.1)', fill: false, tension: 0.4 },
        { label: 'Pharmacy', data: [null, null, null, null, null, 18, 18, 18], borderColor: '#f39c12', backgroundColor: 'rgba(243, 156, 18, 0.1)', fill: false, tension: 0.4 },
        { label: 'State Public University', data: [null, null, null, null, null, null, null, 2], borderColor: '#1abc9c', backgroundColor: 'rgba(26, 188, 156, 0.1)', fill: false, tension: 0.4 },
        { label: 'Architecture', data: [null, null, null, null, null, null, null, null], borderColor: '#8b4513', backgroundColor: 'rgba(139, 69, 19, 0.1)', fill: false, tension: 0.4 }
      ]
    };

    const config = {
      type: 'line',
      data: data,
      options: {
        responsive: true,
        plugins: { 
          legend: { display: false },
          tooltip: {
            mode: 'index',
            intersect: false,
            backgroundColor: 'rgba(0,0,0,0.8)',
            titleColor: '#fff',
            bodyColor: '#fff',
            cornerRadius: 8
          }
        },
        scales: {
          y: {
            reverse: true,
            title: { 
              display: true, 
              text: 'Rank',
              font: { size: 14, weight: '600' },
              color: '#2c3e50'
            },
            grid: {
              color: 'rgba(0,0,0,0.05)'
            }
          },
          x: {
            title: {
              display: true,
              text: 'Year',
              font: { size: 14, weight: '600' },
              color: '#2c3e50'
            },
            grid: {
              color: 'rgba(0,0,0,0.05)'
            }
          }
        },
        interaction: {
          mode: 'nearest',
          axis: 'x',
          intersect: false
        }
      }
    };

    const chart = new Chart(document.getElementById('nirfChart'), config);

    function update2025() {
      const categories = ['Overall','University','Engineering','Research','Pharmacy','StatePublicUniversity','Architecture'];
      let updated = false;
      
      categories.forEach((cat, idx) => {
        const inputVal = document.getElementById(cat + '-2025').value;
        const cell = document.getElementById(cat + '-2025-cell');
        
        if (inputVal) {
          const newRank = parseInt(inputVal);
          cell.innerText = newRank;
          cell.style.background = 'linear-gradient(135deg, #2ecc71, #27ae60)';
          cell.style.color = 'white';
          cell.style.fontWeight = '600';
          
          if (!data.labels.includes(2025)) {
            data.labels.push(2025);
          }
          
          // Update or add 2025 data
          if (data.datasets[idx].data.length === labels.length) {
            data.datasets[idx].data.push(newRank);
          } else {
            data.datasets[idx].data[data.datasets[idx].data.length - 1] = newRank;
          }
          
          // Check if this new rank is better than historical best for top 4 categories
          if (['Overall', 'University', 'Engineering', 'Research'].includes(cat)) {
            const currentBest = findBestRankAndYears(cat, false);
            const newBest = findBestRankAndYears(cat, true, newRank);
            
            // If the new 2025 rank is better (lower number) than the previous best
            if (newBest.bestRank < currentBest.bestRank) {
              updateBestRankCard(cat, newBest.bestRank, newBest.bestYears, true);
            }
            // If it ties with the best rank, update the years list
            else if (newBest.bestRank === currentBest.bestRank && newBest.bestYears.length > currentBest.bestYears.length) {
              updateBestRankCard(cat, newBest.bestRank, newBest.bestYears, true);
            }
          }
          
          updated = true;
        } else {
          if (data.datasets[idx].data.length === labels.length) {
            data.datasets[idx].data.push(null);
          }
        }
      });
      
      if (updated) {
        chart.update();
        
        // Show success feedback
        const button = event.target;
        const originalText = button.innerHTML;
        button.innerHTML = 'âœ… Updated!';
        button.style.background = 'linear-gradient(135deg, #2ecc71, #27ae60)';
        
        setTimeout(() => {
          button.innerHTML = originalText;
          button.style.background = 'linear-gradient(135deg, #3498db 0%, #2980b9 100%)';
        }, 2000);
      }
    }

    function downloadChart() {
      // Get the existing chart canvas
      const originalCanvas = document.getElementById('nirfChart');
      
      // Create a new canvas for the download with higher resolution
      const downloadCanvas = document.createElement('canvas');
      const ctx = downloadCanvas.getContext('2d');
      
      // Set canvas size for high quality output
      downloadCanvas.width = 1200;
      downloadCanvas.height = 800;
      
      // Fill with white background
      ctx.fillStyle = '#ffffff';
      ctx.fillRect(0, 0, downloadCanvas.width, downloadCanvas.height);
      
      // Add header text
      ctx.fillStyle = '#1e3c72';
      ctx.font = 'bold 32px Arial, sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('Jadavpur University - NIRF Rankings', downloadCanvas.width / 2, 50);
      
      ctx.fillStyle = '#2a5298';
      ctx.font = '20px Arial, sans-serif';
      ctx.fillText('Trend Analysis (2017 Onwards)', downloadCanvas.width / 2, 85);
      
      // Calculate the chart area
      const chartArea = {
        x: 80,
        y: 120,
        width: downloadCanvas.width - 160,
        height: downloadCanvas.height - 200
      };
      
      // Draw chart background
      ctx.fillStyle = '#f8f9fa';
      ctx.fillRect(chartArea.x, chartArea.y, chartArea.width, chartArea.height);
      
      // Copy the original chart to the download canvas
      try {
        ctx.drawImage(originalCanvas, chartArea.x + 40, chartArea.y + 20, chartArea.width - 80, chartArea.height - 100);
      } catch (error) {
        console.log('Direct copy failed, using alternative method');
        // Alternative: Get chart as base64 image
        const chartImage = chart.toBase64Image('image/jpeg', 1);
        const img = new Image();
        img.onload = function() {
          ctx.drawImage(img, chartArea.x + 40, chartArea.y + 20, chartArea.width - 80, chartArea.height - 100);
          triggerDownload();
        };
        img.src = chartImage;
        return;
      }
      
      triggerDownload();
      
      function triggerDownload() {
        // Convert to blob and download
        downloadCanvas.toBlob(function(blob) {
          const url = URL.createObjectURL(blob);
          const downloadLink = document.createElement('a');
          const date = new Date();
          downloadLink.href = url;
          downloadLink.download = `JU_NIRF_Rankings_${date.getFullYear()}_${String(date.getMonth() + 1).padStart(2, '0')}_${String(date.getDate()).padStart(2, '0')}.jpg`;
          
          // Trigger download
          document.body.appendChild(downloadLink);
          downloadLink.click();
          document.body.removeChild(downloadLink);
          
          // Clean up
          URL.revokeObjectURL(url);
          
          // Show success feedback
          const button = document.querySelector('.download-btn');
          const originalText = button.innerHTML;
          button.innerHTML = 'âœ… Downloaded!';
          button.style.background = 'linear-gradient(135deg, #27ae60, #2ecc71)';
          
          setTimeout(() => {
            button.innerHTML = originalText;
            button.style.background = 'linear-gradient(135deg, #2ecc71 0%, #27ae60 100%)';
          }, 2000);
        }, 'image/jpeg', 0.95);
      }
    }
  </script>
</body>
</html>
